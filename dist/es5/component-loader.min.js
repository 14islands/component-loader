"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),ComponentLoader=function(){function t(){var e=void 0===arguments[0]?{}:arguments[0],n=void 0===arguments[1]?document:arguments[1];_classCallCheck(this,t),this.contextEl=n,this.initializedComponents={},this.numberOfInitializedComponents=0,this.components={},this.topics={},this.register(e)}return _createClass(t,[{key:"register",value:function(){var t=this,e=void 0===arguments[0]?{}:arguments[0];Object.keys(e).forEach(function(n){t.components[n]=e[n]})}},{key:"unregister",value:function(t){delete this.components[t]}},{key:"subscribe",value:function(t,e,n){this.topics.hasOwnProperty(t)||(this.topics[t]=[]),this.topics[t].push({context:n,callback:e})}},{key:"unsubscribe",value:function(t,e,n){if(!this.topics.hasOwnProperty(t))return!1;for(var i=0,o=this.topics[t].length;o>i;i++)if(this.topics[t][i].callback===e&&(!n||this.topics[t][i].context===n))return this.topics[t].splice(i,1),!0;return!1}},{key:"publish",value:function(t){if(!this.topics.hasOwnProperty(t))return!1;for(var e=new Array(arguments.length-1),n=0;n<e.length;++n)e[n]=arguments[n+1];for(var i=0,o=this.topics[t].length;o>i;i++){var a=this.topics[t][i];a&&a.callback&&a.callback.apply(a.context,e)}return!0}},{key:"scan",value:function(){var t=this,e=void 0===arguments[0]?{}:arguments[0],n={},i=this.contextEl.querySelectorAll("[data-component]");[].forEach.call(i,function(i){t._scanElement(i,n,e)}),this.numberOfInitializedComponents>0&&this.cleanUp_(n)}},{key:"_scanElement",value:function(t,e,n){var i=this,o=t.getAttribute("data-component-id");o||(o=this._generateUUID(),t.setAttribute("data-component-id",o));var a=t.getAttribute("data-component").match(/\S+/g);a.forEach(function(a){var r=a+"-"+o;e[r]=!0,i.initializedComponents[r]||i._initializeComponent(a,r,t,n)})}},{key:"_initializeComponent",value:function(t,e,n,i){var o=this.components[t];if("function"!=typeof o)throw"ComponentLoader: unknown component '"+t+"'";var a=new o(n,i,this);this.initializedComponents[e]=a,this.numberOfInitializedComponents++}},{key:"_destroyComponent",value:function(t){var e=this.initializedComponents[t];e&&"function"==typeof e.destroy&&e.destroy(),delete this.initializedComponents[t],this.numberOfInitializedComponents--}},{key:"cleanUp_",value:function(){var t=this,e=void 0===arguments[0]?{}:arguments[0];Object.keys(this.initializedComponents).forEach(function(n){e[n]||t._destroyComponent(n)})}},{key:"_generateUUID",value:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,n="x"==t?e:3&e|8;return n.toString(16)})}}]),t}();"undefined"!=typeof define&&define.amd?define([],ComponentLoader):"undefined"!=typeof module&&module.exports?module.exports=ComponentLoader:window.ComponentLoader=ComponentLoader;