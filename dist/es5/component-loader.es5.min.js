"use strict";function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n}}(),ComponentLoader=function(){function t(){var n=void 0===arguments[0]?{}:arguments[0],e=void 0===arguments[1]?document:arguments[1];_classCallCheck(this,t),this.contextEl=e,this.initializedComponents={},this.numberOfInitializedComponents=0,this.components={},this.topics={},this.register(n)}return _createClass(t,[{key:"register",value:function(){var t=this,n=void 0===arguments[0]?{}:arguments[0];Object.keys(n).forEach(function(e){t.components[e]=n[e]})}},{key:"unregister",value:function(t){delete this.components[t]}},{key:"subscribe",value:function(t,n,e){this.topics.hasOwnProperty(t)||(this.topics[t]=[]),this.topics[t].push({context:e,callback:n})}},{key:"unsubscribe",value:function(t,n){if(!this.topics.hasOwnProperty(t))return!1;for(var e=0,i=this.topics[t].length;i>e;e++)if(this.topics[t][e].callback===n)return this.topics[t].splice(e,1),!0;return!1}},{key:"publish",value:function(t){var n=void 0;if(!this.topics.hasOwnProperty(t))return!1;n=Array.slice(arguments,1);for(var e=0,i=this.topics[t].length;i>e;e++){var o=this.topics[t][e];o.callback&&o.callback.apply(o.context,n)}return!0}},{key:"scan",value:function(){var t=this,n=void 0===arguments[0]?{}:arguments[0],e={},i=this.contextEl.querySelectorAll("[data-component]");[].forEach.call(i,function(i){t._scanElement(i,e,n)}),this.numberOfInitializedComponents>0&&this.cleanUp_(e)}},{key:"_scanElement",value:function(t,n,e){var i=this,o=t.getAttribute("data-component-id");o||(o=this._generateUUID(),t.setAttribute("data-component-id",o));var a=t.getAttribute("data-component").match(/\S+/g);a.forEach(function(a){var r=a+"-"+o;n[r]=!0,i.initializedComponents[r]||i._initializeComponent(a,r,t,e)})}},{key:"_initializeComponent",value:function(t,n,e,i){var o=this.components[t];if("function"!=typeof o)throw"ComponentLoader: unknown component '"+t+"'";var a=new o(e,i,this);this.initializedComponents[n]=a,this.numberOfInitializedComponents++}},{key:"_destroyComponent",value:function(t){var n=this.initializedComponents[t];n&&"function"==typeof n.destroy&&n.destroy(),delete this.initializedComponents[t],this.numberOfInitializedComponents--}},{key:"cleanUp_",value:function(){var t=this,n=void 0===arguments[0]?{}:arguments[0];Object.keys(this.initializedComponents).forEach(function(e){n[e]||t._destroyComponent(e)})}},{key:"_generateUUID",value:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=16*Math.random()|0,e="x"==t?n:3&n|8;return e.toString(16)})}}]),t}();module.exports=ComponentLoader;